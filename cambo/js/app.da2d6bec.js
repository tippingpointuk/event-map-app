(function(e){function t(t){for(var r,c,i=t[0],s=t[1],u=t[2],d=0,p=[];d<i.length;d++)c=i[d],Object.prototype.hasOwnProperty.call(o,c)&&o[c]&&p.push(o[c][0]),o[c]=0;for(r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r]);l&&l(t);while(p.length)p.shift()();return a.push.apply(a,u||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],r=!0,i=1;i<n.length;i++){var s=n[i];0!==o[s]&&(r=!1)}r&&(a.splice(t--,1),e=c(c.s=n[0]))}return e}var r={},o={app:0},a=[];function c(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,c),n.l=!0,n.exports}c.m=e,c.c=r,c.d=function(e,t,n){c.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},c.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.t=function(e,t){if(1&t&&(e=c(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(c.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)c.d(n,r,function(t){return e[t]}.bind(null,r));return n},c.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return c.d(t,"a",t),t},c.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},c.p="/event-map-app/cambo/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],s=i.push.bind(i);i.push=t,i=i.slice();for(var u=0;u<i.length;u++)t(i[u]);var l=s;a.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"0ca7":function(e,t,n){},2298:function(e,t,n){"use strict";n("0ca7")},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var r=n("7a23");function o(e,t,n,o,a,c){var i=Object(r["l"])("EventMap");return Object(r["h"])(),Object(r["c"])(i,{source:a.source},null,8,["source"])}var a={id:"map-pane",ref:"map"},c={class:"overlay"};function i(e,t,n,o,i,s){var u=Object(r["l"])("EventBox");return Object(r["h"])(),Object(r["d"])(r["a"],null,[Object(r["e"])("div",a,null,512),Object(r["e"])("div",c,[(Object(r["h"])(!0),Object(r["d"])(r["a"],null,Object(r["k"])(s.visibleEvents,(function(e){return Object(r["h"])(),Object(r["c"])(u,{key:e.id,event:e},null,8,["event"])})),128))])],64)}var s=n("5530"),u=(n("d3b7"),n("d81d"),n("4de4"),n("ac1f"),n("5319"),n("caad"),n("2532"),n("159b"),n("e11e")),l=n.n(u),d=n("2573"),p=(n("6cc5"),n("8243"),n("3ac1"),n("e2b9")),f=n.n(p),v=n("6397"),b=n.n(v),m=["id"],h={class:"top"},O={class:"description"},j={class:"header-line"},g=["href"],y=["href"],w=Object(r["e"])("span",{class:"Chaos-Button"},"Join",-1),k=[w];function M(e,t,n,o,a,c){return Object(r["h"])(),Object(r["d"])("div",{class:Object(r["g"])(["EventBox",{online:e.online}]),id:e.id},[Object(r["e"])("div",h,[Object(r["e"])("div",O,[Object(r["e"])("div",j,[Object(r["e"])("h3",null,[Object(r["e"])("a",{target:"_parent",href:e.url},Object(r["m"])(e.title),9,g)]),Object(r["e"])("a",{target:"_parent",href:e.url},k,8,y)]),Object(r["e"])("p",null,[Object(r["e"])("time",null,Object(r["m"])(e.start.time),1),Object(r["f"])(" on "+Object(r["m"])(e.start.date),1)]),Object(r["e"])("address",null,Object(r["m"])(e.location.venue)+", "+Object(r["m"])(e.location.locality),1)])])],10,m)}var _={name:"EventsBox",props:{event:{type:Object,required:!0}},data:function(){return this.event}},x=(n("2298"),n("6b0d")),C=n.n(x);const B=C()(_,[["render",M]]);var E=B,S={name:"EventMap",props:{source:{type:String,required:!0}},components:{EventBox:E},data:function(){return{map:{},markers:[],events:[],icon:new l.a.icon({iconSize:[25,41],iconAnchor:[13,41],iconUrl:b.a,shadowUrl:f.a})}},mounted:function(){var e=this;fetch(this.source,{method:"GET"}).then((function(e){return e.json()})).then((function(t){console.log("Fetched ".concat(t.length," events.")),console.log(t),e.events=t.map((function(t){return Object(s["a"])(Object(s["a"])({},t),e.getProps(t))})),e.buildMap()}))},computed:{visibleEvents:function(){return this.events.filter((function(e){return e.isVisible}))}},methods:{getProps:function(e){return{start:this.datify(e.start_date),end:this.datify(e.end_date),id:e.browser_url.replace("https://actionnetwork.org/events/",""),url:e.browser_url,online:""==e.location.venue||e.location.venue.toLowerCase().includes("online"),latlng:l.a.latLng(e.location.location.latitude,e.location.location.longitude)}},datify:function(e){if(e){var t=new Date(e);return{time:new Intl.DateTimeFormat("en-GB",{hour:"numeric",minute:"numeric",timeZone:"UTC"}).format(t),date:new Intl.DateTimeFormat("en-GB",{weekday:"short",month:"short",day:"numeric",timeZone:"UTC"}).format(t),raw:t}}return null},updateMarkers:function(e){console.log("updating markers"),this.events.forEach((function(t,n,r){r[n]["isVisible"]=e.contains(r[n].latlng)})),console.log(this.events)},buildMap:function(){var e=this;console.log("Building map");var t=l.a.map(this.$refs.map,{center:[10,0],crs:l.a.CRS.EPSG3857,zoom:2,zoomControl:!0,preferCanvas:!1});l.a.tileLayer("https://stamen-tiles-{s}.a.ssl.fastly.net/watercolor/{z}/{x}/{y}.jpg",{attribution:'Map tiles by <a href="http://stamen.com">Stamen Design</a>, under <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a>. Data by &copy; <a href="http://openstreetmap.org">OpenStreetMap</a>, under <a href="http://creativecommons.org/licenses/by-sa/3.0">CC BY SA</a>.',detectRetina:!1,maxNativeZoom:18,minZoom:0,noWrap:!1,opacity:1,subdomains:"abc",tms:!1}).addTo(t),console.log("Building marker cluster.");var n=new d["MarkerClusterGroup"]({maxClusterRadius:25}).addTo(t);for(var r in console.log("Adding points"),this.events){var o=this.events[r],a=l.a.marker(o.latlng,{icon:this.icon});a.eventData=o,this.markers.push(a)}n.addLayers(this.markers);var c=function(){var n=t.getBounds();e.updateMarkers(n)};c(),t.on("zoom",c),t.on("moveend",c),t.on("resize",c)}}};n("f103");const P=C()(S,[["render",i],["__scopeId","data-v-dfd42202"]]);var T=P,z={name:"App",data:function(){return{source:"https://an-events.tippingpointuk.workers.dev"}},components:{EventMap:T}};n("e478");const D=C()(z,[["render",o]]);var G=D;Object(r["b"])(G).mount("#app")},7419:function(e,t,n){},"9acd":function(e,t,n){},e478:function(e,t,n){"use strict";n("9acd")},f103:function(e,t,n){"use strict";n("7419")}});
//# sourceMappingURL=app.da2d6bec.js.map